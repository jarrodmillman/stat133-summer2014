<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Section Notes - 3 - Stat 133 (summer 2014)</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    

    <!-- Open Graph tags -->
        <meta property="og:site_name" content="Stat 133 (summer 2014)" />
            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Section Notes - 3"/>
            <meta property="og:url" content="http://www.jarrodmillman.com/stat133-summer2014/notes3.html"/>
            <meta property="og:description" content="Functions and Unit Testing Functions Functions are an important tool for interacting with data in R. You&#39;re probably already familiar with the idea of functions from math classes. In R, we use functions to manipulate some input argument(s) and return some output arguments(s). You&#39;ve already seen ..."/>
            <meta property="article:published_time" content="2014-06-17" />
                <meta property="article:section" content="misc" />
                <meta property="article:author" content="Karl Kumbier" />

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://www.jarrodmillman.com/stat133-summer2014/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://www.jarrodmillman.com/stat133-summer2014/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://www.jarrodmillman.com/stat133-summer2014/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://www.jarrodmillman.com/stat133-summer2014/theme/css/style.css" type="text/css"/>

        <link href="http://www.jarrodmillman.com/stat133-summer2014/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Stat 133 (summer 2014) ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://www.jarrodmillman.com/stat133-summer2014/" class="navbar-brand">
Stat 133 (summer 2014)            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="http://www.jarrodmillman.com/stat133-summer2014/pages/about.html">About</a></li>
                    <li><a href="http://www.jarrodmillman.com/stat133-summer2014/pages/lectures.html">Lectures</a></li>
                    <li><a href="http://www.jarrodmillman.com/stat133-summer2014/pages/software.html">Software</a></li>
                    <li><a href="https://piazza.com/berkeley/summer2014/statistics133/home">Discussion</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://www.jarrodmillman.com/stat133-summer2014/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://www.jarrodmillman.com/stat133-summer2014/notes3.html"
                       rel="bookmark"
                       title="Permalink to Section Notes - 3">
                        Section Notes - 3
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-06-17T00:00:00"> Tue 17 June 2014</time>
    </span>



    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h1>Functions and Unit Testing</h1>
<h2>Functions</h2>
<p>Functions are an important tool for interacting with data in R. You're probably
already familiar with the idea of functions from math classes. In R, we use
functions to manipulate some input argument(s) and return some output
arguments(s). You've already seen some examples of built in R functions:</p>
<div class="highlight"><pre><span class="c1"># Take the mean of &lt;numeric.vector&gt;</span>
numeric.vector <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span>
<span class="kp">mean</span><span class="p">(</span>numeric.vector<span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## [1] 5.5
</pre></div>


<div class="highlight"><pre><span class="c1"># Generate 10 standard normal random variables</span>
rnorm<span class="p">(</span><span class="m">10</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>##  [1]  1.8051 -1.3698  0.2661  0.4697  1.0124  1.5709  0.4211  0.8027
##  [9]  0.2071  0.9277
</pre></div>


<p>R also allows you to define your own functions. The implementation of a generic
function is shown below.</p>
<div class="highlight"><pre>someFunction <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>arg1<span class="p">,</span> arg2<span class="p">,</span> <span class="kc">...</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1"># statement </span>
    <span class="c1"># return(object)</span>

<span class="p">}</span>
</pre></div>


<p>The following code (when the statement and return values are not commented out)
would store a function called "someFunction" in your workspace. When called,
someFunction would perform the computations indicated by "statement" (presumably
on the values supplied by <strong>arg1</strong>, <strong>arg2</strong>, ...) and return the value
<strong>object</strong> (presumably a result of the computations in "statement"). It is
important to note that <em>implementing</em> a function is different than <em>calling</em> the
function. When we <em>implement</em> a function, it is stored in your workspace for
later use.  When we <em>call</em> a function, we are telling R to use the stored function to actually perform the calculations associated with it.</p>
<div class="highlight"><pre><span class="c1"># Here, we are implementing the function &#39;add&#39;. This function takes two</span>
<span class="c1"># arguments and returns their sum.</span>
add <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> y<span class="p">)</span> <span class="p">{</span>
    result <span class="o">&lt;-</span> x <span class="o">+</span> y
    <span class="kr">return</span><span class="p">(</span>result<span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Here, we are calling the function with different arguments</span>
add<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## [1] 2
</pre></div>


<div class="highlight"><pre>add<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## [1] 10
</pre></div>


<div class="highlight"><pre>add<span class="p">(</span><span class="m">1.5</span><span class="p">,</span> <span class="m">2.5</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## [1] 4
</pre></div>


<p>Something that is important to note with R is that functions can only return
<em>one</em> result. If we want to write a function that returns multiple values, we
can get around this by having the function return a vector or list (depending on
whether the return values are the same type). Suppose we wanted to write a
function that returned both the sum and difference of its two arguments.</p>
<div class="highlight"><pre><span class="c1"># This function will throw an error when it is called when it tries to</span>
<span class="c1"># return multiple results</span>
sumDiff <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> y<span class="p">)</span> <span class="p">{</span>
    result.sum <span class="o">&lt;-</span> x <span class="o">+</span> y
    result.diff <span class="o">&lt;-</span> x <span class="o">-</span> y
    <span class="kr">return</span><span class="p">(</span>result.sum<span class="p">,</span> result.diff<span class="p">)</span>
<span class="p">}</span>

sumDiff<span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error: multi-argument returns are not permitted
</pre></div>


<div class="highlight"><pre><span class="c1"># Either of these functions will work since we combine the two return values</span>
<span class="c1"># into one argument</span>
sumDiff <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> y<span class="p">)</span> <span class="p">{</span>
    result.sum <span class="o">&lt;-</span> x <span class="o">+</span> y
    result.diff <span class="o">&lt;-</span> x <span class="o">-</span> y
    <span class="kr">return</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span>result.sum<span class="p">,</span> result.diff<span class="p">))</span>
<span class="p">}</span>

sumDiff<span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## [1] 6 2
</pre></div>


<div class="highlight"><pre>sumDiff <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> y<span class="p">)</span> <span class="p">{</span>
    result.sum <span class="o">&lt;-</span> x <span class="o">+</span> y
    result.diff <span class="o">&lt;-</span> x <span class="o">-</span> y
    <span class="kr">return</span><span class="p">(</span><span class="kt">list</span><span class="p">(</span>s <span class="o">=</span> result.sum<span class="p">,</span> d <span class="o">=</span> result.diff<span class="p">))</span>
<span class="p">}</span>

sumDiff<span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="cp">##</span><span class="c"> $s</span><span class="x"></span>
<span class="cp">##</span><span class="c"> [1] 6</span><span class="x"></span>
<span class="cp">##</span><span class="c"> </span><span class="x"></span>
<span class="cp">##</span><span class="c"> $d</span><span class="x"></span>
<span class="cp">##</span><span class="c"> [1] 2</span><span class="x"></span>
</pre></div>


<h3>A brief mention of scoping</h3>
<p>When you start to define functions, you'll need to think about what variables different parts of the program have access. This idea is known as <em>scoping</em>. R uses <em>lexical scoping</em> which means that functions access variables relative to where they are defined (as opposed to where they are called). The basic idea is that when you use a variable in the body of a function, R will first look to see if that variable is defined in the body. If it isn't, R will move to the environment in which the function was defined (i.e. your workspace or the body of another function). As with many things in R, an example should make this a bit more clear.</p>
<div class="highlight"><pre>bob.age <span class="o">=</span> <span class="m">10</span>
jane.age <span class="o">=</span> <span class="m">12</span>
getAge <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>person<span class="p">)</span> <span class="p">{</span>
    <span class="kr">if</span> <span class="p">(</span>person <span class="o">==</span> <span class="s">&quot;Bob&quot;</span><span class="p">)</span> 
        <span class="kr">return</span><span class="p">(</span>bob.age<span class="p">)</span> 
    <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span>person <span class="o">==</span> <span class="s">&quot;Jane&quot;</span><span class="p">)</span> 
        <span class="kr">return</span><span class="p">(</span>jane.age<span class="p">)</span>
<span class="p">}</span>

getNewAge <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>person<span class="p">)</span> <span class="p">{</span>
    bob.age <span class="o">=</span> <span class="m">11</span>
    jane.age <span class="o">=</span> <span class="m">13</span>
    getAge<span class="p">(</span>person<span class="p">)</span>
<span class="p">}</span>

getNewAge<span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## [1] 10
</pre></div>


<div class="highlight"><pre>getNewAge<span class="p">(</span><span class="s">&quot;Jane&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## [1] 12
</pre></div>


<p>The definition of "getAge" requires the variables <strong>bob.age</strong> and <strong>jane.age</strong>. Since they are not defined in the body of the function, R looks up one level and finds them defined in the workspace. Whenever we call the function "getAge", these variables in the workspace are tied to the values that "getAge" returns. Even if we redefine the variables <strong>bob.age</strong> and <strong>jane.age</strong> in a new environment (the body of "getNewAge"), "getAge" will still access the variables from the workspace because of where it was defined.</p>
<h2>Unit Testing</h2>
<p>When you learned basic algebra, you were probably told to check your answer by
plugging your result back into the equation. This is an easy test to make sure
you performed the correct calculations. As you start to build larger projects in
R (or any language for that matter), it becomes increasingly important to check
that your code is performing correctly along the way. Unit testing packages in R
provide the framework to test your code in this way. We're going to cover the
"RUnit" package, but there are other unit testing packages that work
well. First, you'll have to install the package using the following command:</p>
<div class="highlight"><pre>install.packages<span class="p">(</span><span class="s">&quot;RUnit&quot;</span><span class="p">)</span>
</pre></div>


<p>Whenever you install a package, make sure the name is in quotes. Otherwise R
will think you're referring to some variable in the workspace. You should get a
prompt telling you to select a CRAN Mirror, choose CA1. After the package is
installed, you'll need to load it using the following command:</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span><span class="s">&quot;RUnit&quot;</span><span class="p">)</span>
</pre></div>


<p>Congratulations! You can now use all of the functions supplied in the RUnit
package. You will have to load the package (using "library") every time you
start a new R session, but you don't have to install it again. The most
important functions for you to know in this package are the check functions:
"checkEquals", "checkEqualsNumeric", "checkIdentical", "checkTrue",
"checkException".  These functions are used to compare the output of your
functions with some expected output (target value, logical, or exception).</p>
<p>If our function returns some numeric value, we can use "checkEquals" to compare
the output of our function with the desired value:</p>
<div class="highlight"><pre>checkEquals<span class="p">(</span>add<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="m">2</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## [1] TRUE
</pre></div>


<div class="highlight"><pre>checkEquals<span class="p">(</span>add<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="m">4</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>## Error: Mean relative difference: 1
</pre></div>


<p>If our function returns a logical, we can check to see whether it returns TRUE
when we expect it to:</p>
<div class="highlight"><pre>isPositive <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
    <span class="kr">return</span><span class="p">(</span>x <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span>
<span class="p">}</span>

checkTrue<span class="p">(</span>isPositive<span class="p">(</span><span class="m">1</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre>## [1] TRUE
</pre></div>


<div class="highlight"><pre>checkTrue<span class="p">(</span>isPositive<span class="p">(</span><span class="m">-1</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre>## Error: Test not TRUE
</pre></div>


<p>You'll notice that R throws an error when the check statements don't evaluate to
TRUE. Normally, you would write your tests in such a way that the statements
evaluate to TRUE if your function performs as you expect it to. Thus,
an error in the test for some specific function would indicate that it is not doing what
you expect. Often times, you'll want to use multiple tests for each function to
check the range of input/output values you expect to use/see. However, if one of
the tests throws an error, our program will stop running and the remaining tests
will fail to evaluate. To prevent this, we'll use a "tryCatch"
statement. Essentially, R will try to evaluate some statement and then perform a
specified action if an error is thrown. We'll write a function "divide" to show
this in action. We would like "divide" to perform standard division in R, but
when dividing by 0 it should return NA instead of Inf.</p>
<div class="highlight"><pre><span class="c1"># This is an incorrect version of the function. It will throw an error when</span>
<span class="c1"># we try to run our unit tests on it</span>

divide <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>numerator<span class="p">,</span> denominator<span class="p">)</span> <span class="p">{</span>
    <span class="kr">return</span><span class="p">(</span>numerator<span class="o">/</span>denominator<span class="p">)</span>
<span class="p">}</span>

<span class="kp">tryCatch</span><span class="p">(</span>checkIdentical<span class="p">(</span>divide<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> <span class="kc">NA</span><span class="p">),</span> error <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>err<span class="p">)</span> <span class="kp">print</span><span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Error:&quot;</span><span class="p">,</span> 
    err<span class="p">)))</span>
</pre></div>


<div class="highlight"><pre>## [1] &quot;Error: Error in checkIdentical(divide(1, 0), NA): FALSE \n&quot;
</pre></div>


<div class="highlight"><pre><span class="kp">tryCatch</span><span class="p">(</span>checkEquals<span class="p">(</span>divide<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span> <span class="m">0.5</span><span class="p">),</span> error <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>err<span class="p">)</span> <span class="kp">print</span><span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Error:&quot;</span><span class="p">,</span> 
    err<span class="p">)))</span>
</pre></div>


<div class="highlight"><pre>## [1] TRUE
</pre></div>


<p>If we ran this code without "tryCatch", R would throw an error after the first
test and stop running. As a result, our second test wouldn't get
evaluated. This means we wouldn't be able to tell if there was a problem with
our entire function or just a small part. With "tryCatch" we can test different
evaluations of our function all at once, which helps
isolate why the function is failing. After seeing the output in the example
above, it would be clear that our function is dividing properly but not dealing
with the divide by 0 case like we expect it to.</p><script type= "text/javascript">
    if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
        var mathjaxscript = document.createElement('script');
        mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
        mathjaxscript.type = 'text/javascript';
        mathjaxscript.src = 'https:' == document.location.protocol
                ? 'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'
                : 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
        mathjaxscript[(window.opera ? "innerHTML" : "text")] =
            "MathJax.Hub.Config({" +
            "    config: ['MMLorHTML.js']," +
            "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
            "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
            "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
            "    displayAlign: 'center'," +
            "    displayIndent: '0em'," +
            "    showMathMenu: true," +
            "    tex2jax: { " +
            "        inlineMath: [ ['$','$'] ], " +
            "        displayMath: [ ['$$','$$'] ]," +
            "        processEscapes: true," +
            "        preview: 'TeX'," +
            "    }, " +
            "    'HTML-CSS': { " +
            "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
            "    } " +
            "}); ";
        (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
    }
</script>

            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">



    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://www.r-project.org/" target="_blank">
                R home
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://cran.r-project.org/manuals.html" target="_blank">
                R docs
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://rseek.org/" target="_blank">
                R seek
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://software-carpentry.org" target="_blank">
                Software Carpentry
            </a>
        </li>
      </ul>
    </li>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 K. Jarrod Millman
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://www.jarrodmillman.com/stat133-summer2014/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://www.jarrodmillman.com/stat133-summer2014/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://www.jarrodmillman.com/stat133-summer2014/theme/js/respond.min.js"></script>

</body>
</html>